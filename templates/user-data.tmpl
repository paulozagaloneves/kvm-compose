#cloud-config
manage_etc_hosts: true
preserv_hostname: false
timezone: Europe/Lisbon
package_upgrade: true
package_update: true
runcmd:
  - [ sh, -c, 'swapoff -a' ]
  - [ sh, -c, 'echo "overlay" >> /etc/modules-load.d/k8s.conf' ]
  - [ sh, -c, 'echo "br_netfilter" >> /etc/modules-load.d/k8s.conf' ]
  - [ sh, -c, 'modprobe overlay' ]
  - [ sh, -c, 'modprobe br_netfilter' ]
  - [ sh, -c, 'echo "net.bridge.bridge-nf-call-iptables  = 1" >> /etc/sysctl.d/k8s.conf' ]  
  - [ sh, -c, 'echo "net.bridge.bridge-nf-call-ip6tables = 1" >> /etc/sysctl.d/k8s.conf' ] 
  - [ sh, -c, 'echo "net.ipv4.ip_forward                 = 1" >> /etc/sysctl.d/k8s.conf' ]
  - [ sh, -c, 'sysctl --system' ]
#  - [ sh, -c, 'dnf install -y epel-release' ]     # Uncomment if EPEL is needed
#  - [ sh, -c, 'dnf install -y fastfetch' ]         # installing fastfetch package on Fedora/AlmaLinux
users:
  - name: {{.Username}}
    ssh_authorized_keys:
      - {{.SSHPublicKey}}
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    shell: /bin/bash
    lock_passwd: false
    passwd: $6$6nSuV5lzM5PbWqmO$BDdl.4vfjyNIr4pamvGGOPF81yo7D7LIb33fCJh5rxbGszKOT6cpmSe5oX76TRnkpvkDlgAUfEmj4gMj7gAUu0